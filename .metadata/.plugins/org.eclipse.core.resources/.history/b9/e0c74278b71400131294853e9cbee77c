package com.personal.rents.activities.workers;

import com.google.android.gms.maps.GoogleMap;
import com.google.android.gms.maps.model.MarkerOptions;
import com.google.android.gms.maps.model.VisibleRegion;
import com.personal.rents.R;
import com.personal.rents.model.Rent;
import com.personal.rents.rest.clients.RentsRESTClient;

import android.content.Context;
import android.os.AsyncTask;
import android.view.LayoutInflater;
import android.view.View;

import java.util.List;

public class AddMarkersWorker extends AsyncTask<VisibleRegion, Void, List<Rent>> {
	
	private GoogleMap rentsMap;
	
	public AddMarkersWorker(GoogleMap pRentsMap) {
		rentsMap = pRentsMap;
	}
	
	@Override
	protected List<Rent> doInBackground(VisibleRegion... visibleRegions) {
		VisibleRegion visibleRegion = visibleRegions[0];
		List<Rent> rents = RentsRESTClient.getRentsPositions(visibleRegion.latLngBounds.southwest,
				visibleRegion.latLngBounds.northeast);

		return rents;
	}

	@Override
	protected void onPostExecute(List<Rent> result) {
		View marker = ((LayoutInflater) getSystemService(Context.LAYOUT_INFLATER_SERVICE))
				.inflate(R.layout.rent_marker_icon_layout, null);
		for(Rent rent : result) {
			rentsMap.addMarker(new MarkerOptions().position(rent.position));
		}
	}
}
