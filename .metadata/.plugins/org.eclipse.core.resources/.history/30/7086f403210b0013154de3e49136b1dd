package com.personal.rents.activities;

import java.util.List;

import com.google.android.gms.maps.GoogleMap;
import com.google.android.gms.maps.SupportMapFragment;
import com.google.android.gms.maps.GoogleMap.OnMyLocationButtonClickListener;
import com.google.android.gms.maps.model.LatLng;
import com.google.android.gms.maps.model.MarkerOptions;
import com.google.android.gms.maps.model.PolygonOptions;
import com.google.android.gms.maps.model.VisibleRegion;
import com.personal.rents.R;
import com.personal.rents.activities.helpers.LocationHelper;

import android.graphics.Color;
import android.location.Location;
import android.os.Bundle;
import android.support.v7.app.ActionBarActivity;

public class MapRentsActivity extends ActionBarActivity implements OnMyLocationButtonClickListener {

    public GoogleMap rentsMap;

    private LocationHelper locationHelper;
    
    private VisibleRegion visibleRegion;
    
    private SupportMapFragment rentsMapFragment;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.map_rents_layout);
        locationHelper = new LocationHelper(getApplicationContext());
        setUpMapIfNeeded();
    }

    @Override
    public boolean onMyLocationButtonClick() {
        return false;
    }
    
	private void setUpMapIfNeeded() {		
		if (rentsMap == null) {
			rentsMapFragment = (SupportMapFragment) getSupportFragmentManager()
					.findFragmentById(R.id.rents_map);
			rentsMap = rentsMapFragment.getMap();
	        if (rentsMap != null) {
	        	setUpMap();
	        }
		}
	}
	
	private void setUpMap() {
		rentsMap.setMyLocationEnabled(true);
        rentsMap.setOnMyLocationButtonClickListener(this);

        Location location = locationHelper.getLastKnownLocation();
        if(location!=null) {
        	locationHelper.moveToLocation(location, rentsMap);
        }
        
        visibleRegion = rentsMap.getProjection().getVisibleRegion();
        
        rentsMap.addMarker(new MarkerOptions().position(visibleRegion.latLngBounds.northeast).title("Upper right corner"));
        rentsMap.addMarker(new MarkerOptions().position(visibleRegion.latLngBounds.southwest).title("Bottom left corner"));

//        List<LatLng> rectPoints = 
//        		locationHelper.getMapBoundariesPoints(rentsMap, rentsMapWidth, rentsMapHeight);
//        rentsMap.addPolygon(new PolygonOptions()
//        		.addAll(rectPoints)
//        		.fillColor(Color.CYAN)
//        		.strokeColor(Color.BLUE)
//        		.strokeWidth(5));
	}
}
